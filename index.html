<!DOCTYPE html>
<html lang="es" xml:lang="es">

<head>
    <title>Validacions Metro BCN</title>

    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta charset="utf-8">

    <script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"></script>
    <script src="leaflet-sidebar.js"></script>
    <!-- <script src="https://raw.github.com/calvinmetcalf/leaflet-ajax/master/dist/leaflet.ajax.min.js"></script> -->

    <link href="https://maxcdn.bootstrapcdn.com/font-awesome/4.1.0/css/font-awesome.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.7.1/dist/leaflet.css" />
    <!--[if lte IE 8]><link rel="stylesheet" href="https://cdn.leafletjs.com/leaflet-0.7.2/leaflet.ie.css" /><![endif]-->

    <link rel="stylesheet" href="leaflet-sidebar.css" />

    <!-- Mapbox GL -->
    <link href="https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.css" rel='stylesheet' />
    <script src="https://api.tiles.mapbox.com/mapbox-gl-js/v1.2.0/mapbox-gl.js"></script>
    <script src="https://rawgit.com/mapbox/mapbox-gl-leaflet/master/leaflet-mapbox-gl.js"></script>

    <!-- nearest point -->
    <script src="https://unpkg.com/leaflet-knn@0.1.0/leaflet-knn.js"></script>


    <!--multiselect-->
    <link rel="stylesheet" href="https://netdna.bootstrapcdn.com/bootstrap/3.3.2/css/bootstrap.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.2/js/bootstrap.min.js"></script>


    <!--Locate Control-->
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.css" />
    <script src="https://cdn.jsdelivr.net/npm/leaflet.locatecontrol/dist/L.Control.Locate.min.js"
        charset="utf-8"></script>

    <!--Geocoder -->
    <script src="https://rawgit.com/k4r573n/leaflet-control-osm-geocoder/master/Control.OSMGeocoder.js"></script>
    <link rel="stylesheet"
        href="https://rawgit.com/k4r573n/leaflet-control-osm-geocoder/master/Control.OSMGeocoder.css" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css" />
    <script src="https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js"></script>

    <!-- Easy Button -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
    <script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>




    <style>
        body {
            padding: 0;
            margin: 0;
        }

        html,
        body,
        #mapid {
            height: 100%;
            font: 10pt "Helvetica Neue", Arial, Helvetica, sans-serif;
        }

        .lorem {
            font-style: italic;
            color: #AAA;
        }

        #container {
            width: 100%;
        }

        #geocodeError {
            position: absolute;
            display: none;
            top: 0;
            bottom: 0;
            left: 0;
            right: 0;
            margin: auto;
            padding: 25px;
            width: 250px;
            height: 150px;
            background: #fff;
            border: 2px solid #000;
            font-weight: bold;
            font-size: 1.1em;
            text-align: center;
            z-index: 2000;
        }

        #errorCloseBtn {
            position: absolute;
            padding: 8px;
            top: 2px;
            right: 4px;
            font-weight: bold;
            font-size: 0.96em;
        }

        #errorText {
            margin-top: 30px;
        }


        .leaflet-control-layers-toggle:after {

            color: rgb(26, 24, 24);
            font-weight: bold;
            font-size: 14px;
            padding-right: 50px;


        }

        .leaflet-control-layers-toggle {
            width: auto;
            background-position: 10px 50%;
            text-decoration: none;
            line-height: 36px;
            padding-right: 50px;
        }

        .multiselect {

            background-image: linear-gradient(135deg, rgb(0, 153, 137), rgb(175, 203, 55));
            background-color: rgb(0, 153, 137);
            color: white;
            z-index: 1000000;
            position: absolute;
            border: 0px;
            box-shadow: 2px 2px 5px #aaaaaa;

        }

        .multiselect:hover,
        .multiselect:focus {
            background-image: linear-gradient(135deg, rgb(0, 120, 107), rgb(143, 170, 27)) !important;
            background-color: rgb(56, 95, 83);
            color: white !important;
        }

        .poptitle {
            font-size: 16px;
            font-weight: bolder;
            text-align: center;
        }

        .pop {
            text-align: center;
        }

        .logo {
            width: 150px;
            text-align: center;
        }

        .titol {
            font-weight: bolder;
            font-size: 16px;
            text-align: center;
            padding-top: 5px;
        }

        .leaflet-control-container .leaflet-routing-container-hide {
            display: none;
        }

        .barra,
        .btn-group {
            z-index: 10000;
        }

        .barra {
            background: white;
            border-radius: 5px;

            z-index: 10000;
            position: relative;
        }

        .tooltip-mapa {
            font-size: 1.20em;
        }

        tbody {
            text-align: center;
        }

        .tit {
            text-align: center;
            font-size: 1em;
            background-image: rgb(0, 153, 137);
            background-color: rgb(0, 153, 137);
            color: white;

        }

        .ix {
            font-weight: bolder;

        }

        #legend {
            position: absolute;
            z-index: 100000;
            bottom: 0;
            right: 0;
        }

        #botonet {
            background-color: rgb(117, 117, 117);
            color: rgb(233, 233, 233);
            font-weight: bolder;
            width: 100%;
            margin-top: 3em;
        }

        #botonet:hover,
        #botonet:after {
            background-color: rgb(48, 48, 48);
            color: rgb(252, 252, 252);
        }

        #demo {
            text-align: center;
        }

        .telef {
            color: black !important;
            font-weight: bold;
        }

        #goto {
            background-color: rgb(0, 153, 137);
            color: white;
            margin-top: 1em;
        }

        #goto:hover,
        #goto:after {
            background-color: rgb(2, 97, 87);
            color: rgb(252, 252, 252);
        }

        .ok {
            width: 2em;
        }

        #filtre {
            background-image: linear-gradient(135deg, rgb(4, 143, 108), rgb(2, 83, 63));
            background-color: rgb(4, 143, 108);
            color: white;
            z-index: 10000;
            position: absolute;
            border: 0px;
            box-shadow: 2px 2px 5px #aaaaaa;

        }

        .filtre:hover,
        .filtre:focus {
            background-image: linear-gradient(135deg, rgb(4, 143, 108), rgb(2, 83, 63)) !important;
            background-color: rgb(9, 16, 59);
            color: white !important;
        }

        .titolet {
            text-align: center;
            font-weight: bolder;
            font-size: 1em;
            padding-top: 1em;
            padding-bottom: 1em;
        }

        .legend {
            line-height: 22px;
            color: #555;
            background-color: #fff;
            padding: 1em;
            border-radius: 5%;
        }

        .legend i {
            width: 18px;
            height: 18px;
            float: left;
            margin-right: 8px;
            opacity: 0.7;
        }



        .circle {
            float: left;
            border: none;
            border-radius: 50%;

        }

        #fosc {
            background-color: rgb(82, 82, 82);
            color: rgb(255, 255, 255);
            font-weight: bolder;
            width: 80%;
            position: absolute;
            z-index: 10000;
            text-align: center;
            margin-top: 4em;
            margin-left: 2em;
        }

        #fosc:hover,
        #fosc:after {
            background-color: rgb(44, 44, 44);
            color: rgb(255, 255, 255);
        }

        #fosc2 {
            background-color: rgb(82, 82, 82);
            color: rgb(255, 255, 255);
            font-weight: bolder;
            width: 80%;
            position: absolute;
            z-index: 10000;
            text-align: center;
            margin-top: 7em;
            margin-left: 2em;
        }

        #fosc2:hover,
        #fosc2:after {
            background-color: rgb(44, 44, 44);
            color: rgb(255, 255, 255);
        }

        #fosc3 {
            background-color: rgb(82, 82, 82);
            color: rgb(255, 255, 255);
            font-weight: bolder;
            width: 80%;
            position: absolute;
            z-index: 10000;
            text-align: center;
            margin-top: 10em;
            margin-left: 2em;
        }

        #fosc3:hover,
        #fosc3:after {
            background-color: rgb(44, 44, 44);
            color: rgb(255, 255, 255);
        }

        #fosc4 {
            background-color: rgb(82, 82, 82);
            color: rgb(255, 255, 255);
            font-weight: bolder;
            width: 80%;
            position: absolute;
            z-index: 10000;
            text-align: center;
            margin-top: 13em;
            margin-left: 2em;
        }

        #fosc4:hover,
        #fosc4:after {
            background-color: rgb(44, 44, 44);
            color: rgb(255, 255, 255);
        }

        #fosc5 {
            background-color: rgb(82, 82, 82);
            color: rgb(255, 255, 255);
            font-weight: bolder;
            width: 80%;
            position: absolute;
            z-index: 10000;
            text-align: center;
            margin-top: 16em;
            margin-left: 2em;

        }

        #fosc5:hover,
        #fosc5:after {
            background-color: rgb(44, 44, 44);
            color: rgb(255, 255, 255);
        }

        #fosc6 {
            background-color: rgb(82, 82, 82);
            color: rgb(255, 255, 255);
            font-weight: bolder;
            width: 80%;
            position: absolute;
            z-index: 10000;
            text-align: center;
            margin-top: 19em;
            margin-left: 2em;
        }

        #fosc6:hover,
        #fosc6:after {
            background-color: rgb(44, 44, 44);
            color: rgb(255, 255, 255);
        }

        #selected {
            background-color: rgb(82, 82, 82);
            color: rgb(240, 131, 8);
            font-weight: bolder;
            width: 80%;
            position: absolute;
            z-index: 10000;
            text-align: center;
            margin-top: 1em;
            margin-left: 2em;
        }

        #selected:hover,
        #selected:after {
            background-color: rgb(44, 44, 44);
            color: rgb(240, 131, 8);
        }
    </style>
</head>

<body>

    <div id="sidebar" class="sidebar collapsed">
        <!-- Categories -->
        <div class="sidebar-tabs">
            <ul role="tablist">
                
                <li><a href="#messages" role="tab"><i class="fa fa-map"></i></a></li>
                
                <li><a href="#profile" role="tab"><i class="fa fa-search"></i></a></li>


                <li><a href="#settings" role="tab" target="_blank"><i class="fa fa-gear"></i></a></li>
            </ul>

            <ul role="tablist">
                <li><a href="mailto:marcrb3@gmail.com" role="tab"><i class="fa fa-question"></i></a></li>
            </ul>
        </div>

        <!-- Tab panes -->
        <div class="sidebar-content">
            

            <div class="sidebar-pane" id="profile">
                <h1 class="sidebar-header" style="text-align: center;">Cerca<span class="sidebar-close"><i
                            class="fa fa-times"></i></span>
                </h1>
                <p style="margin-top: 1em; font-size: 1.2em; "><strong>Introdueix una adreça, municipi, codi postal o
                        topònim.</strong></p>


            </div>

            <div class="sidebar-pane" id="messages">
                <h1 class="sidebar-header" style="margin-bottom: 1em; text-align: center;">Mapa de validacions<span
                        class="sidebar-close"><i class="fa fa-times"></i></span>
                </h1>

                
            <label style="padding-right: 1em">Validacions per operador: </label>   
                <select name="select" id="filtre" class="tipus" style="padding-right: 1em;">
                    <option value="buit" hidden selected>Selecciona</option>
                    <option value="FMB">Metro</option>
                    <option value="FGC">FGC</option>
                    <option value="ROD">Rodalies</option>
                    <option value="TB">TMB</option>
                    <option value="TRAM">TRAM</option>
                    <option value="TUSGSAL">TUSGSAL</option>
                    <option value="BAIXBUS">BaixBus</option>
                    <option value="NITBUS">NitBus</option>
                </select>

            </div>

            <div class="sidebar-pane" id="settings">
                <h1 class="sidebar-header" style="text-align: center;">Configuració<span class="sidebar-close"><i
                            class="fa fa-times"></i></span>
                </h1>
                <p style="margin-top: 1em; font-size: 1.2em;"><strong>Selecciona el tema del visor:</strong></p>
                <div class="tema">

                    <a class="btn" id="fosc" href="#" role="button">Fosc</a>
                </div>
            </div>
           

        </div>
    </div>





    <div id="mapid" class="sidebar-map"> </div>

    <script>
        var mymap;
        var validacions = $.ajax({
            url: "https://raw.githubusercontent.com/Marcrb3/val/main/val_FER.geojson",
            dataType: "json",
            success: console.log("Capa geojson carregada correctament."),
            error: function (xhr) {
                alert(xhr.statusText)
            }
        })
        var linies = $.ajax({
            url: "https://raw.githubusercontent.com/Marcrb3/val/main/ferroviari.geojson",
            dataType: "json",
            success: console.log("Capa geojson 2 carregada correctament."),
            error: function (xhr) {
                alert(xhr.statusText)
            }
        })
        var val_bus = $.ajax({
            url: "https://raw.githubusercontent.com/Marcrb3/val/main/val_bus.geojson",
            dataType: "json",
            success: console.log("Capa geojson 3 carregada correctament."),
            error: function (xhr) {
                alert(xhr.statusText)
            }
        })

        $.when(linies, validacions, val_bus).done(function () {

            mymap = L.map('mapid', {
                minZoom: 9,
                maxBounds: [
                    //sud-oest
                    [40.33825, -1.0391],
                    //nord-est
                    [42.88239, 5.06357]
                ],
            }).setView([41.385243705090105, 2.1402139383833516], 11.5);

            var sidebar = L.control.sidebar('sidebar', {
                position: 'left'
            }).addTo(mymap);
            sidebar.open('messages');


            var Topo = L.mapboxGL({
                style: 'mapbox://styles/marcrb3/ckvkmr0pi400f14oap3nljgkx',
                accessToken: 'pk.eyJ1IjoibWFyY3JiMyIsImEiOiJjanJqanZvMXowYzdnNDRsbGN4N3JyMGhuIn0.im2TOkqyqEpCXhN4LWoZuA',
                attribution: 'Developed by Marc Roca Ballesteros ©'
            }).addTo(mymap);


            var basemap = {
                'Topogràfic': Topo
            };

            var kxIncidents, kyIncidents, kyCorones, kyAMB, kyBus;
            var capes = L.control.layers(basemap, null, { collapsed: false });
            capes.addTo(mymap);
            capes._container.remove();
            L.control.scale().addTo(mymap);
            grup = L.layerGroup(kxIncidents, kyIncidents, Topo, kyAMB, kyBus);
            L.control.locate({ position: 'topleft', flyTo: "true", initialZoomLevel: "13" }).addTo(mymap);
            var control = L.Control.geocoder({ placeholder: "Cerca..." });

            document.getElementById('profile').appendChild(
                control.onAdd(mymap)
            );


            L.Map.include({
                'clearLayers': function () {
                    this.eachLayer(function (layer) {
                        this.removeLayer(layer);
                    }, this);
                }
            });

            //Carreguem la capa al iniciar el mapa

            kyIncidents = L.geoJSON(validacions.responseJSON);

            kyAMB = L.geoJSON(linies.responseJSON);

            kyBus = L.geoJSON(val_bus.responseJSON);



            //Obrim la secció d'informació de la sidebar 

            var sidebarDiv = document.getElementById('sidebar');


            toggleSidebar = function () {
                if (hasClass(sidebarDiv, 'collapsed')) {
                    sidebar.open('home');

                }
                else { sidebar.open('home') };
            }

            function hasClass(element, cls) {
                return (' ' + element.className + ' ').indexOf(' ' + cls + ' ') > -1;
            }


            //Netegem el mapa per poder alternar entre capes

            function neteja() {
                mymap.clearLayers();
                Topo.addTo(mymap);
            }


            //Desplegable i filtratge per operador

            $("select.tipus").change(function () {
                selectedTipus = $(this).children("option:selected").val();

                console.log(selectedTipus);

                if (selectedTipus == "FMB") {
                    neteja();

                    kyIncidents = L.geoJSON(validacions.responseJSON, {
                        onEachFeature: onEachFeature,
                        style: style,
                        pointToLayer: function (feature, latlng) {
                            return L.circleMarker(latlng, {
                                radius: getRadiusFMB(feature.properties.val),
                                fillColor: "white",
                                color: "#000",
                                weight: 1,
                                opacity: 1,
                                fillOpacity: 0.5

                            });

                        },
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "FMB");

                        }

                    }).addTo(mymap);

                    kyAMB = L.geoJSON(linies.responseJSON, {
                        style: style_line_FMB,
                        onEachFeature: onEachFeature2,
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "FMB");

                        }
                    }).addTo(mymap);
                    sidebar.close();
                }

                else if (selectedTipus == "FGC") {
                    neteja();
                    kyIncidents = L.geoJSON(validacions.responseJSON, {
                        onEachFeature: onEachFeature,
                        style: style,
                        pointToLayer: function (feature, latlng) {
                            return L.circleMarker(latlng, {
                                radius: getRadiusFGC(feature.properties.val),
                                fillColor: "white",
                                color: "#000",
                                weight: 1,
                                opacity: 1,
                                fillOpacity: 0.5

                            });

                        },
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "FGC");

                        }

                    }).addTo(mymap);

                    kyAMB = L.geoJSON(linies.responseJSON, {
                        style: style_line_FGC,
                        onEachFeature: onEachFeature2,
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "FGC");

                        }
                    }).addTo(mymap);
                    sidebar.close();
                }

                else if (selectedTipus == "ROD") {
                    neteja();
                    kyIncidents = L.geoJSON(validacions.responseJSON, {
                        onEachFeature: onEachFeature,
                        style: style,
                        pointToLayer: function (feature, latlng) {
                            return L.circleMarker(latlng, {
                                radius: getRadiusROD(feature.properties.val),
                                fillColor: "white",
                                color: "#000",
                                weight: 1,
                                opacity: 1,
                                fillOpacity: 0.5

                            });

                        },
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "ROD");

                        }

                    }).addTo(mymap);

                    kyAMB = L.geoJSON(linies.responseJSON, {
                        style: style_line_ROD,
                        onEachFeature: onEachFeature2,
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "ROD");

                        }
                    }).addTo(mymap);
                    sidebar.close();
                }

                else if (selectedTipus == "TB") {
                    neteja();
                    kyBus = L.geoJSON(val_bus.responseJSON, {
                        onEachFeature: onEachFeatureBus,
                        style: styleTMB,
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "TMB");

                        }

                    }).addTo(mymap);
                    sidebar.close();
                }

                else if (selectedTipus == "TUSGSAL") {
                    neteja();
                    kyBus = L.geoJSON(val_bus.responseJSON, {
                        onEachFeature: onEachFeatureBus,
                        style: styleTUG,
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "TUSGSAL");

                        }

                    }).addTo(mymap);
                    sidebar.close();
                }

                else if (selectedTipus == "NITBUS") {
                    neteja();
                    kyBus = L.geoJSON(val_bus.responseJSON, {
                        onEachFeature: onEachFeatureBus,
                        style: styleNB,
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "NITBUS");

                        }

                    }).addTo(mymap);
                    sidebar.close();
                }

                else if (selectedTipus == "BAIXBUS") {
                    neteja();
                    kyBus = L.geoJSON(val_bus.responseJSON, {
                        onEachFeature: onEachFeatureBus,
                        style: styleBB,
                        filter: function (feature, layer) {

                            return (feature.properties.operador == "BAIXBUS");

                        }

                    }).addTo(mymap);
                    sidebar.close();
                }
            });


//Paletes de colors

            function getColorFMB(d) {
                return d == 'L11' ? '#89B94C' :
                    d == 'L10S' ? '#00A6D6' :
                        d == 'L10N' ? '#00A6D6' :
                            d == 'L9N' ? '#FB712B' :
                                d == 'L9S' ? '#FB712B' :
                                    d == 'L5' ? '#005A97' :
                                        d == 'L4' ? '#F7A30E' :
                                            d == 'L3' ? '#1EB53A' :
                                                d == 'L2' ? '#93248F' :
                                                    d == 'L1' ? '#CE1126' :
                                                        '#ffffff';
            }

            function getColorFGC(d) {
                return d == 'MM' ? '#000000' :
                    d == 'R50' ? '#00738a' :
                        d == 'FV' ? '#0A57A3' :
                            d == 'R5' ? '#3dbfc3' :
                                d == 'R53' ? '#3dbfc3' :
                                    d == 'S8' ? '#49C0DE' :
                                        d == 'S3' ? '#4F868E' :
                                            d == 'ES' ? '#5A5858' :
                                                d == 'R60' ? '#5b5b5b' :
                                                    d == 'S5' ? '#5B8FCB' :
                                                        d == 'S5S' ? '#5B8FCB' :
                                                            d == 'L6' ? '#797FBC' :
                                                                d == 'S2' ? '#88BB0B' :
                                                                    d == 'S7' ? '#9B2743' :
                                                                        d == 'S4' ? '#A78600' :
                                                                            d == 'L7' ? '#B2600B' :
                                                                                d == 'L12' ? '#b2aed3' :
                                                                                    d == 'R6' ? '#b3b3b3' :
                                                                                        d == 'R63' ? '#b3b3b3' :
                                                                                            d == 'S9' ? '#DF4661' :
                                                                                                d == 'L8' ? '#E274AA' :
                                                                                                    d == 'S6' ? '#E40046' :
                                                                                                        d == 'S1' ? '#EF7900' :
                                                                                                            '#ffffff';
            }

            function getColorROD(d) {
                return d == 'R8' ? '#88006a' :
                    d == 'R7' ? '#b57bba' :
                        d == 'R4' ? '#f6a30d' :
                            d == 'R3' ? '#ea412b' :
                                d == 'R2S' ? '#136524' :
                                    d == 'R2N' ? '#d0de00' :
                                        d == 'R2' ? '#26a741' :
                                            d == 'R1' ? '#7dbcec' :
                                                '#ffffff';
            }

            function getRadiusFMB(d) {
                return d > 500 ? '18' :
                    d > 243 ? '16' :
                        d > 154 ? '14' :
                            d > 125 ? '12' :
                                d > 85 ? '10' :
                                    d > 63 ? '8' :
                                        d > 49 ? '6' :
                                            d > 28 ? '4' :
                                                d > 1 ? '2' :
                                                    '1';
            }

            function getRadiusROD(d) {
                return d > 200 ? '18' :
                    d > 150 ? '16' :
                        d > 100 ? '15' :
                            d > 75 ? '14' :
                                d > 50 ? '12' :
                                    d > 25 ? '10' :
                                        d > 15 ? '8' :
                                            d > 10 ? '6' :
                                                d > 1 ? '4' :
                                                    '2';
            }


            function getRadiusFGC(d) {
                return d > 200 ? '18' :
                    d > 150 ? '16' :
                        d > 100 ? '15' :
                            d > 75 ? '14' :
                                d > 50 ? '12' :
                                    d > 25 ? '10' :
                                        d > 15 ? '8' :
                                            d > 10 ? '6' :
                                                d > 1 ? '4' :
                                                    '2';
            }

            function getOpacityTMB(d) {
                return d > 384 ? '1' :
                    d > 330 ? '0.9' :
                        d > 275 ? '0.8' :
                            d > 220 ? '0.7' :
                                d > 165 ? '0.6' :
                                    d > 111 ? '0.5' :
                                        d > 56 ? '0.45' :
                                            d > 1 ? '0.4' :
                                                '0';
            }

            function getWeightTMB(d) {
                return d > 384 ? '4' :
                    d > 330 ? '3.5' :
                        d > 275 ? '3' :
                            d > 220 ? '2.5' :
                                d > 165 ? '2' :
                                    d > 111 ? '1.5' :
                                        d > 56 ? '1' :
                                            d > 1 ? '0.5' :
                                                '0';
            }

            function getOpacityTUG(d) {
            return d > 546 ? '1' :
                d > 455 ? '0.9' :
                    d > 384 ? '0.8' :
                        d > 224 ? '0.7' :
                            d > 132 ? '0.6' :
                                d > 56 ? '0.5' :
                                    d > 24 ? '0.45' :
                                        d > 1 ? '0.4' :
                                            '0';
        }

        function getWeightTUG(d) {
            return d > 546 ? '4' :
                d > 455 ? '3.5' :
                    d > 384 ? '3' :
                        d > 224 ? '2.5' :
                            d > 132 ? '2' :
                                d > 56 ? '1.5' :
                                    d > 24 ? '1' :
                                        d > 1 ? '0.5' :
                                            '0';
        }

        function getOpacityNB(d) {
            return d > 48 ? '1' :
                d > 40 ? '0.9' :
                    d > 30 ? '0.8' :
                        d > 25 ? '0.7' :
                            d > 20 ? '0.6' :
                                d > 14 ? '0.5' :
                                    d > 8 ? '0.45' :
                                        d > 1 ? '0.4' :
                                            '0';
        }

        function getWeightNB(d) {
            return d > 48 ? '4' :
                d > 40 ? '3.5' :
                    d > 30 ? '3' :
                        d > 25 ? '2.5' :
                            d > 20 ? '2' :
                                d > 14 ? '1.5' :
                                    d > 8 ? '1' :
                                        d > 1 ? '0.5' :
                                            '0';
        }

        function getOpacityBB(d) {
            return d > 1264 ? '1' :
                d > 408 ? '0.9' :
                    d > 288 ? '0.8' :
                        d > 198 ? '0.7' :
                            d > 108 ? '0.6' :
                                d > 54 ? '0.5' :
                                    d > 18 ? '0.45' :
                                        d > 1 ? '0.4' :
                                            '0';
        }

        function getWeightBB(d) {
            return d > 1264 ? '4' :
                d > 408 ? '3.5' :
                    d > 288 ? '3' :
                        d > 198 ? '2.5' :
                            d > 108 ? '2' :
                                d > 54 ? '1.5' :
                                    d > 18 ? '1' :
                                        d > 1 ? '0.5' :
                                            '0';
        }
            //Estil

            function style(feature) {
                return {
                    weight: 1,
                    color: 'black',
                    dashArray: '',
                    fillOpacity: 0.55


                };
            }
            function styleTMB(feature) {
                return {
                    weight: getWeightTMB(feature.properties.val),
                    opacity: getOpacityTMB(feature.properties.val),
                    color: 'red',
                    dashArray: '',
                    fillOpacity: 1,


                };
            }
            
            function styleTUG(feature) {
                return {
                    weight: getWeightTUG(feature.properties.val),
                    opacity: getOpacityTUG(feature.properties.val),
                    color: '#FFCC00',
                    dashArray: '',
                    fillOpacity: 1,
                };
            }

            function styleNB(feature) {
                return {
                    weight: getWeightNB(feature.properties.val),
                    opacity: getOpacityNB(feature.properties.val),
                    color: '#3366CC',
                    dashArray: '',
                    fillOpacity: 1,
                };
            }

            function styleBB(feature) {
                return {
                    weight: getWeightBB(feature.properties.val),
                    opacity: getOpacityBB(feature.properties.val),
                    color: '#FFCC00',
                    dashArray: '',
                    fillOpacity: 1,
                };
            }

            function style_line_FMB(feature) {
                return {
                    weight: 2.5,
                    opacity: 1,
                    color: getColorFMB(feature.properties.routes_rou),
                    dashArray: '',
                    fillOpacity: 1,

                };
            }
            function style_line_FGC(feature) {
                return {
                    weight: 2.5,
                    opacity: 1,
                    color: getColorFGC(feature.properties.routes_rou),
                    dashArray: '',
                    fillOpacity: 1,

                };
            }
            function style_line_ROD(feature) {
                return {
                    weight: 2.5,
                    opacity: 1,
                    color: getColorROD(feature.properties.routes_rou),
                    dashArray: '',
                    fillOpacity: 1,

                };
            }


            //ressaltem el contorn dels poligons al fer hover
            function highlightFeature(e) {
                var layer = e.target;

                layer.setStyle({
                    weight: 3,
                    color: 'black',
                    dashArray: '',
                    fillOpacity: 0.55
                });

                if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                    layer.bringToFront();
                }
            }

            function highlightFeatureL(e) {
                var layer = e.target;

                layer.setStyle({
                    weight: 5,

                });

                if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
                    layer.bringToFront();
                }
            }

            //restablim el contorn al fer mouseout


            function resetHighlight(e) {
                var layer = e.target;

                layer.setStyle({
                    weight: 1,
                    color: 'black',
                    dashArray: '',
                    fillOpacity: 0.55
                });
            }

            function resetHighlightL(e) {
                var layer = e.target;

                layer.setStyle({
                    weight: 2.5,

                });

            }

            function zoomToFeature(e) {
                mymap.flyToBounds(e.target.getBounds());
            }

            function zoomToFeature2(e) {

                mymap.flyTo(e.latlng, 16);
            }

            //Omplim el contingut de la sidebar al clicar sobre qualsevol dels barris

            function onEachFeature(feature, layer) {

                layer.bindTooltip("<h5 class='infoHeader'><strong>Parada: " + feature.properties.stop_name + "<br><br> Validacions: " + feature.properties.val + "</h5>");

                layer.on({
                    mouseover: highlightFeature,
                    mouseout: resetHighlight,
                    click: zoomToFeature2
                });

            }

            function onEachFeature2(feature, layer) {
                layer.bindTooltip("<h5 class='infoHeader'><strong>Línia: " + feature.properties.routes_rou + "<br><br>" + feature.properties.routes_r_1 + "</h5>", { sticky: true });

                layer.on({
                    mouseover: highlightFeatureL,
                    mouseout: resetHighlightL,
                    click: zoomToFeature
                });
            }

            function onEachFeatureBus(feature, layer) {

                layer.bindTooltip("<h5 class='infoHeader'><strong>Linia: " + feature.properties.routes_rou + "<br><br> Validacions: " + feature.properties.val + "</h5>", { sticky: true });

                layer.on({
                    click: zoomToFeature
                });

            }

        });
    </script>

</body>

</html>